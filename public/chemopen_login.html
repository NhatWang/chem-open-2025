<!DOCTYPE html>
<html lang="vi">
<head>
  <link rel="icon" href="images/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="preload" href="images/chemopen/CHEMOPEN.webp" as="image">
  <meta charset="UTF-8">
  <title>ƒêƒÉng nh·∫≠p qu·∫£n tr·ªã</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
  body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background: url(images/chemopen/CHEMOPEN.webp) no-repeat center center fixed;
  background-size: cover;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  flex-direction: column;
}

.login-container {
 background-color: #ffffff;
  border-radius: 16px;
  padding: 32px;
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
  width: 90%;
  max-width: 500px;
  text-align: center;
  box-sizing: border-box;
  margin: 0 16px;
  z-index: 1;
}

    .login-container h2 {
      font-size: 22px;
      margin-bottom: 20px;
      color: #333;
    }

    .login-container h2 i {
      margin-right: 8px;
      color: #007bff;
    }

    .login-container input {
      width: 85%;
      padding: 12px 14px;
      margin-bottom: 16px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 15px;
      box-sizing: border-box;
    }

    .login-container button {
      width: 70%;
      padding: 12px;
      background-color: #007bff;
      color: white;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    .login-container button:hover {
      background-color: #0056b3;
    }

    @media (max-width: 500px) {
      .login-container {
        width: 90%;
        margin: 0 10px;
        top: 55%;
      }
      .title-container {
        top: 3%;
      }
      .login-container h2 {
        font-size: 18px;
      }
      .login-container input {
        font-size: 14px;
      }
      .login-container button {
        font-size: 14px;
      }
    }

.***HIDDEN***-wrapper {
  position: relative;
}

.***HIDDEN***-wrapper input {
  width: 85%;
  padding-right: 44px; /* ƒë·ªÉ ch·ª´a ch·ªó cho icon üëÅ */
}

.toggle-***HIDDEN*** {
  position: absolute;
  top: 50%;
  right: 45px;
  transform: 
  translateY(-80%);
  cursor: pointer;
  font-size: 20px;
  color: #666;
}
.title-container {
  display: flex;
  justify-content:center;
  align-items: center;
  width: 100%;
  z-index: 1;
  padding: 0;
  margin: 0;
}
.auth-links {
  margin-top: 20px;
  font-size: 15px;
  text-align: center;
  color: #444;
}

.auth-links p {
  margin: 6px 0;
}

.auth-links a {
  color: #007bff;
  text-decoration: none;
  font-weight: 500;
  transition: color 0.2s ease;
}

.auth-links a:hover {
  color: #0056b3;
  text-decoration: underline;
}

.title-image {
  max-width: 45%;
  height: auto;
  display: block;
}
.footer {
    position: relative;        
    z-index: 2;                
    text-align: center;
    font-size: 15px;
    padding: 20px 10px;
    margin-top: 15px;
    color: #000000;
    font-weight: 500;
}
  </style>
</head>
<body>
  <div class="title-container">
    <img src="images/chemopen/Title.webp" alt="Title" class="title-image">
  </div>
  <form class="login-container" id="loginForm">
  <h2><i class="fa-solid fa-lock"></i> ƒêƒÇNG NH·∫¨P TRANG QU·∫¢N TR·ªä</h2>
  <input type="text" id="usernameInput" placeholder="T√™n ƒëƒÉng nh·∫≠p" required />
  <div class="***HIDDEN***-wrapper">
    <input type="***HIDDEN***" id="***HIDDEN***Input" placeholder="M·∫≠t kh·∫©u" required autocomplete="off" />
     <i class="fa-solid fa-eye toggle-***HIDDEN***" onclick="togglePassword(this)"></i>
  </div>
  <button type="submit">ƒêƒÇNG NH·∫¨P</button>
<div class="auth-links">
  <p><i class="fa-solid fa-user-plus me-1"></i>  Ch∆∞a c√≥ t√†i kho·∫£n? <a href="#" onclick="showRegister()">T·∫°o t√†i kho·∫£n</a></p>
  <p><i class="fa-solid fa-key me-1"></i>  Qu√™n m·∫≠t kh·∫©u? <a href="#" onclick="showForgot()">L·∫•y l·∫°i m·∫≠t kh·∫©u</a></p>
</div>
  </form>

<!-- FORM ƒêƒÇNG K√ù ·∫®N M·∫∂C ƒê·ªäNH -->
<form class="login-container" id="registerForm" style="display: none;">
  <h2><i class="fa-solid fa-user-plus"></i> ƒêƒÇNG K√ù T√ÄI KHO·∫¢N</h2>
  <input type="text" id="regUsername" placeholder="T√™n ƒëƒÉng nh·∫≠p" required />
  <input type="text" id="regMSSV" placeholder="M√£ s·ªë sinh vi√™n" required />
  <input type="text" id="regFullName" placeholder="H·ªç v√† t√™n" required />
  <input type="email" id="regEmail" placeholder="Email" required />
  <div class="***HIDDEN***-wrapper">
  <input type="***HIDDEN***" id="regPassword" placeholder="M·∫≠t kh·∫©u" required />
  <i class="fa-solid fa-eye toggle-***HIDDEN***" onclick="togglePassword(this)"></i>
</div>
  <div class="***HIDDEN***-wrapper">
    <input type="***HIDDEN***" id="regConfirmPassword" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u" required />
    <i class="fa-solid fa-eye toggle-***HIDDEN***" onclick="togglePassword(this)"></i>
  </div>
  <input type="hidden" id="regRole" value="collab" />
  <button type="button" onclick="submitRegister()">ƒêƒÇNG K√ù</button>
  <div class="auth-links">
  <p>ƒê√£ c√≥ t√†i kho·∫£n? <a href="#" onclick="showLogin()">Quay l·∫°i ƒëƒÉng nh·∫≠p</a></p>
  </div>
</form>
<form class="login-container" id="forgotForm" style="display: none;">
  <h2><i class="fa-solid fa-key"></i> QU√äN M·∫¨T KH·∫®U</h2>
  <input type="text" id="forgotUsername" placeholder="T√™n ƒëƒÉng nh·∫≠p" required />
  <input type="email" id="forgotEmail" placeholder="Email ƒë√£ ƒëƒÉng k√Ω" required />
  <button type="button" onclick="submitForgot()">G·ª¨I Y√äU C·∫¶U</button>
  <div class="auth-links">
  <p>Quay l·∫°i? <a href="#" onclick="showLogin()">ƒêƒÉng nh·∫≠p</a></p>
  </div>
</form>
<form class="login-container" id="resetForm" style="display: none;">
  <h2><i class="fa-solid fa-key"></i> KH√îI PH·ª§C M·∫¨T KH·∫®U</h2>
  <div class="***HIDDEN***-wrapper">
  <input type="***HIDDEN***" id="newPassword" placeholder="M·∫≠t kh·∫©u m·ªõi" required />
  <i class="fa-solid fa-eye toggle-***HIDDEN***" onclick="togglePassword(this)"></i>
</div>
  <div class="***HIDDEN***-wrapper">
  <input type="***HIDDEN***" id="confirmPassword" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u" required />
  <i class="fa-solid fa-eye toggle-***HIDDEN***" onclick="togglePassword(this)"></i>
</div>
  <button type="button" onclick="submitReset()">ƒê·∫∂T L·∫†I M·∫¨T KH·∫®U</button>
  <div class="auth-links">
  <p>Quay l·∫°i <a href="#" onclick="showLogin()">ƒêƒÉng nh·∫≠p</a></p>
  </div>
</form>

<script>
  function togglePassword(icon) {
    const input = icon.previousElementSibling;
    input.type = input.type === "***HIDDEN***" ? "text" : "***HIDDEN***";
    icon.classList.toggle("fa-eye-slash");
    icon.classList.toggle("fa-eye");
  }


  document.getElementById("loginForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const username = document.getElementById("usernameInput").value;
  const ***HIDDEN*** = document.getElementById("***HIDDEN***Input").value;

  try {
    const response = await fetch("/api/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      credentials: "include",
      body: JSON.stringify({ username, ***HIDDEN*** }),
    });

    const data = await response.json();

    if (response.ok) {
      showToast("üéâ ƒêƒÉng nh·∫≠p th√†nh c√¥ng!", "success");
      setTimeout(() => {
        window.location.href = data.redirect;
      }, 1000);
    } else {
      showToast(data.message || "‚ùå ƒêƒÉng nh·∫≠p th·∫•t b·∫°i!");
    }
  } catch (error) {
    showToast("üö´ Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn m√°y ch·ªß.");
  }
});
  function showToast(message, type = "error") {
  const container = document.getElementById("toast-container");
  const toast = document.createElement("div");

  toast.style.cssText = `
    min-width: 240px;
    margin-bottom: 10px;
    padding: 12px 18px;
    border-radius: 6px;
    font-size: 14px;
    color: white;
    background-color: ${type === "success" ? "#28a745" : "#dc3545"};
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    animation: fadein 0.5s, fadeout 0.5s 3s;
  `;

  toast.textContent = message;
  container.appendChild(toast);

  setTimeout(() => toast.remove(), 3500);
}

// Animation (n√™n th√™m v√†o <style>)
const style = document.createElement("style");
style.innerHTML = `
  @keyframes fadein {
    from { opacity: 0; transform: translateY(20px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  @keyframes fadeout {
    from { opacity: 1; transform: translateY(0); }
    to   { opacity: 0; transform: translateY(20px); }
  }
`;
document.head.appendChild(style);

async function submitRegister() {
  const username = document.getElementById("regUsername").value.trim();
  const fullName = document.getElementById("regFullName").value.trim();
  const ***HIDDEN*** = document.getElementById("regPassword").value;
  const mssv = document.getElementById("regMSSV").value.trim();
  const email = document.getElementById("regEmail").value.trim();
  const role = document.getElementById("regRole").value;

  if (!username || !fullName || !***HIDDEN*** || !mssv || !email) {
    return showToast("‚ö†Ô∏è Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin.");
  }

  try {
    const res = await fetch("/api/register-user", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, ***HIDDEN***, role, mssv, email, fullName })
    });

    const data = await res.json();
    if (res.ok) {
      showToast("‚úÖ ƒêƒÉng k√Ω th√†nh c√¥ng! Vui l√≤ng ch·ªù duy·ªát.", "success");
      showLogin();
    } else {
      showToast(data.message || "‚ùå ƒêƒÉng k√Ω th·∫•t b·∫°i!");
    }
  } catch (err) {
    showToast("‚ùå Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c m√°y ch·ªß.");
  }
}
function showRegister() {
    document.getElementById("loginForm").style.display = "none";
    document.getElementById("registerForm").style.display = "block";
    document.getElementById("forgotForm").style.display = "none";
    document.getElementById("resetForm").style.display = "none";
  }

  function showLogin() {
    document.getElementById("registerForm").style.display = "none";
    document.getElementById("loginForm").style.display = "block";
    document.getElementById("forgotForm").style.display = "none";
    document.getElementById("resetForm").style.display = "none";
  }
function showForgot() {
  document.getElementById("loginForm").style.display = "none";
  document.getElementById("registerForm").style.display = "none";
  document.getElementById("forgotForm").style.display = "block";
  document.getElementById("resetForm").style.display = "none";
}
function showReset() {
  document.getElementById("forgotForm").style.display = "none";
  document.getElementById("resetForm").style.display = "block";
  document.getElementById("loginForm").style.display = "none";
  document.getElementById("registerForm").style.display = "none";
}

async function submitForgot() {
  const username = document.getElementById("forgotUsername").value.trim();
  const email = document.getElementById("forgotEmail").value.trim(); 
  if (!username || !email) return showToast("‚ö†Ô∏è Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin.");

  try {
    const res = await fetch("/api/request-reset", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, email })
    });

    const data = await res.json();
    if (res.ok) {
      showToast("üìß Y√™u c·∫ßu ƒë√£ ƒë∆∞·ª£c g·ª≠i! Vui l√≤ng ki·ªÉm tra email.", "success");
      showLogin();
    } else {
      showToast(data.message || "‚ùå G·ª≠i y√™u c·∫ßu th·∫•t b·∫°i!");
    }
  } catch (err) {
    showToast("‚ùå Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c m√°y ch·ªß.");
  }
}
const urlParams = new URLSearchParams(window.location.search);
const resetToken = urlParams.get("token");
if (resetToken) {
  document.getElementById("loginForm").style.display = "none";
  document.getElementById("resetForm").style.display = "block";
}

async function submitReset() {
  const ***HIDDEN*** = document.getElementById("newPassword").value.trim();
  const confirm = document.getElementById("confirmPassword").value.trim();

  if (!***HIDDEN*** || !confirm) return showToast("‚ö†Ô∏è Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß.");
  if (***HIDDEN*** !== confirm) return showToast("‚ö†Ô∏è M·∫≠t kh·∫©u kh√¥ng kh·ªõp.");

  try {
    const res = await fetch("/api/reset-***HIDDEN***", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ token: resetToken, newPassword: ***HIDDEN*** })
    });

    const data = await res.json();
    if (res.ok) {
      showToast("‚úÖ B·∫°n ƒë√£ ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u th√†nh c√¥ng. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i!", "success");
      showLogin();
      document.getElementById("usernameInput")?.focus();
      history.replaceState({}, document.title, window.location.pathname); // Xo√° token kh·ªèi URL
    } else {
      showToast(data.message || "‚ùå L·ªói ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u.");
    }
  } catch (err) {
    showToast("‚ùå Kh√¥ng th·ªÉ k·∫øt n·ªëi m√°y ch·ªß.");
  }
}
</script>
<div id="toast-container" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999;"></div>
</div>
<script src="chemopen_index.js"></script>
<footer class="footer">
    <strong>¬© 2025 Li√™n chi H·ªôi khoa Ho√° h·ªçc,<br>
    Tr∆∞·ªùng ƒê·∫°i h·ªçc Khoa h·ªçc t·ª± nhi√™n, ƒêHQG-HCM</strong>
  </footer>
</body>
</html>